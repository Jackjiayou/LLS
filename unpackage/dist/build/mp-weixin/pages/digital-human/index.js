(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/digital-human/index"],{"1f53":function(e,t,n){},"283f":function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){}));var o=function(){var e=this.$createElement;this._self._c},a=[]},"4a4b":function(e,t,n){"use strict";var o=n("1f53"),a=n.n(o);a.a},"7c9c":function(e,t,n){"use strict";(function(e){var o=n("47a9");Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=o(n("7eb4")),i=o(n("ee10")),s=o(n("0cd1")),r={data:function(){return{apiBaseUrl:s.default.apiBaseUrl,videoUrl:"",messages:[{type:"assistant",content:"你好，我是珍迪助手，请问有什么可以帮您吗"}],inputMessage:"",scrollTop:0,isVideoLoading:!1,pendingVideoUrl:"",pendingBotMessage:""}},onLoad:function(){this.videoUrl=this.apiBaseUrl+"/uploads/download/hi1.mp4"},methods:{getRandomDefaultVideo:function(){var e=["tp3.mp4","tp3.mp4","tp3.mp4"],t=Math.floor(Math.random()*e.length);return this.apiBaseUrl+"/uploads/download/"+e[t]},handleVideoError:function(t){console.error("视频加载错误:",t),this.videoUrl.includes("hi.mp4")&&(console.log("hi.mp4加载失败，切换到tp3.mp4"),this.videoUrl=this.apiBaseUrl+"/uploads/download/tp3.mp4"),e.showToast({title:"视频加载失败",icon:"none"})},handleVideoLoadStart:function(){this.isVideoLoading=!0},handleVideoLoaded:function(){this.isVideoLoading=!1},handleVideoPlay:function(){var e=this;console.log("视频开始播放"),this.pendingBotMessage&&setTimeout((function(){e.messages.push({type:"assistant",content:e.pendingBotMessage}),e.pendingBotMessage="",e.scrollToBottom()}),1e3)},handleVideoEnded:function(){var e=this;return(0,i.default)(a.default.mark((function t(){var n;return a.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:console.log("视频播放结束，当前视频:",e.videoUrl),console.log("待播放视频:",e.pendingVideoUrl),e.pendingVideoUrl?(console.log("切换到新视频:",e.pendingVideoUrl),e.videoUrl=e.pendingVideoUrl,e.pendingVideoUrl=""):(n=e.getRandomDefaultVideo(),console.log("视频播放结束，切换到随机默认视频:",n),e.videoUrl=n);case 3:case"end":return t.stop()}}),t)})))()},sendMessage:function(){var t=this;return(0,i.default)(a.default.mark((function n(){var o,i,s,r;return a.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.inputMessage.trim()){n.next=2;break}return n.abrupt("return");case 2:return t.messages.push({type:"user",content:t.inputMessage}),o=t.inputMessage,t.inputMessage="",t.scrollToBottom(),n.prev=6,n.next=9,e.request({url:t.apiBaseUrl+"/synthesize",method:"POST",data:{text:o,messages:JSON.stringify(t.messages)},header:{"content-type":"application/x-www-form-urlencoded"},timeout:18e4});case 9:if(i=n.sent,!i.data||!i.data.videoUrl){n.next=33;break}return s=i.data.videoUrl,console.log("新视频URL:",s),n.prev=13,n.next=16,e.request({url:s,method:"HEAD"});case 16:if(r=n.sent,200!==r.statusCode){n.next=22;break}t.pendingVideoUrl=s,t.pendingBotMessage=i.data.text||"已为您生成视频回复",n.next=23;break;case 22:throw new Error("视频文件不可访问");case 23:n.next=31;break;case 25:return n.prev=25,n.t0=n["catch"](13),console.error("视频URL检查失败:",n.t0),e.showToast({title:"视频文件不可访问",icon:"none"}),t.pendingVideoUrl=t.getRandomDefaultVideo(),n.abrupt("return");case 31:n.next=35;break;case 33:console.log("没有返回视频URL，使用随机默认视频"),t.pendingVideoUrl=t.getRandomDefaultVideo();case 35:n.next=43;break;case 37:n.prev=37,n.t1=n["catch"](6),console.error("发送消息失败:",n.t1),e.showToast({title:"发送失败，请重试",icon:"none"}),console.log("发生错误，使用随机默认视频"),t.pendingVideoUrl=t.getRandomDefaultVideo();case 43:t.scrollToBottom();case 44:case"end":return n.stop()}}),n,null,[[6,37],[13,25]])})))()},scrollToBottom:function(){var e=this;setTimeout((function(){e.scrollTop=9999999}),100)},loadMoreMessages:function(){}}};t.default=r}).call(this,n("df3c")["default"])},b9e1:function(e,t,n){"use strict";n.r(t);var o=n("7c9c"),a=n.n(o);for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i);t["default"]=a.a},be6d:function(e,t,n){"use strict";n.r(t);var o=n("283f"),a=n("b9e1");for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);n("4a4b");var s=n("828b"),r=Object(s["a"])(a["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],void 0);t["default"]=r.exports},f9df:function(e,t,n){"use strict";(function(e,t){var o=n("47a9");n("5fd2");o(n("3240"));var a=o(n("be6d"));e.__webpack_require_UNI_MP_PLUGIN__=n,t(a.default)}).call(this,n("3223")["default"],n("df3c")["createPage"])}},[["f9df","common/runtime","common/vendor"]]]);